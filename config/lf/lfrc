# lf configuration file
# Place this file at: ~/.config/lf/lfrc

# Basic settings
set icons false
set ignorecase true
set drawbox true
set preview true
set hidden false
set scrolloff 5

# Custom commands

# Trash using trash-cli (install: apt install trash-cli or pip install trash-cli)
cmd trash %{{
    set -f
    printf "Move %s to trash? [y/N] " "$fx"
    read ans
    [ "$ans" = "y" ] && trash-put -- $fx
}}

# Delete permanently with confirmation
cmd delete %{{
    set -f
    printf "Delete permanently? [y/N] "
    read ans
    [ "$ans" = "y" ] && rm -rf -- $fx
}}

# Extract archive
cmd extract ${{
    set -f
    case $f in
        *.tar.bz2|*.tar.gz|*.tar.xz|*.tar|*.tbz2|*.tgz|*.txz)
            tar xvf $f;;
        *.zip)
            unzip $f;;
        *.rar)
            unrar x $f;;
        *.7z)
            7z x $f;;
        *.gz)
            gunzip $f;;
        *.bz2)
            bunzip2 $f;;
        *)
            echo "Unsupported format";;
    esac
}}

# Compress selection
cmd compress ${{
    set -f
    mkdir -p compressed
    case $1 in
        tar.gz|tgz)
            tar czf "compressed/${PWD##*/}.tar.gz" $fx;;
        tar.bz2|tbz2)
            tar cjf "compressed/${PWD##*/}.tar.bz2" $fx;;
        tar.xz|txz)
            tar cJf "compressed/${PWD##*/}.tar.xz" $fx;;
        zip)
            zip -r "compressed/${PWD##*/}.zip" $fx;;
        7z)
            7z a "compressed/${PWD##*/}.7z" $fx;;
        *)
            echo "Usage: compress [tar.gz|tar.bz2|tar.xz|zip|7z]";;
    esac
}}

# Paste with progress
cmd paste &{{
    set -- $(cat ~/.local/share/lf/files)
    mode="$1"
    shift
    case "$mode" in
        copy)
            rsync -av --progress -- "$@" . |
            stdbuf -i0 -o0 -e0 tr '\r' '\n' |
            while IFS= read -r line; do
                lf -remote "send $id echo $line"
            done
            ;;
        move)
            mv -n -- "$@" .;;
    esac
    rm ~/.local/share/lf/files
    lf -remote "send clear"
    lf -remote "send $id reload"
}}

# Smart create: file or directory based on trailing slash
cmd create ${{
    set -f
    if [ -z "$1" ]; then
        echo "Usage: create <name> or <name/> for directory"
        echo "Examples: myfile, path/to/file, myfolder/, path/to/folder/"
    else
        case "$1" in
            */)
                # Ends with slash - create directory
                mkdir -p "${1%/}"
                lf -remote "send $id select \"${1%/}\""
                ;;
            */*)
                # Contains slash but doesn't end with one - create file with parent dirs
                mkdir -p "$(dirname "$1")"
                touch "$1"
                lf -remote "send $id select \"$1\""
                ;;
            *)
                # No slash - create file in current directory
                touch "$1"
                lf -remote "send $id select \"$1\""
                ;;
        esac
    fi
}}

# Rename with existing name prefilled
cmd rename %[ -e $1 ] && printf "file exists" || mv $f $1

# Bulk rename with default editor
cmd bulkrename ${{
    vidir
}}

# Open file with default application
cmd open ${{
    case $(file --mime-type -Lb $f) in
        text/*) $EDITOR $fx;;
        *) xdg-open $f > /dev/null 2>&1 &;;
    esac
}}

# Key mappings (vim-like)

# Basic movement (default, but explicit)
map k up
map j down
map h updir
map l open
map gg top
map G bottom

# File operations
map yy copy          # Yank/copy
map x cut            # Alternative cut
map p paste          # Paste
map T trash         # Move to trash
map D delete         # Delete permanently

# Archive operations  
map az push :compress<space>  # Compress (prompts for format)
map ax extract                # Extract

# File/directory creation
map a push :create<space>     # Smart create (file or directory with /)

# Rename operations
map r push :rename<space>     # Rename (prompts for new name)
map R bulkrename              # Bulk rename with vidir

# Other useful mappings
map <enter> open              # Open file
map . set hidden!             # Toggle hidden files
map <space> :toggle; down     # Select and move down
map u unselect                # Unselect all
map / search                  # Search
map n search-next             # Next search result
map N search-prev             # Previous search result

# Bookmarks (using ' like vim marks)
map 'h cd ~
map 'd cd ~/Downloads
map 'D cd ~/Documents
map 'p cd ~/Pictures
map 'v cd ~/Videos
map 't cd /tmp

# Clear selections
map c clear

# Reload
map <c-r> reload

# Quit
map q quit
